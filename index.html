<!DOCTYPE html>
<html lang="ko">
<head>
  <!-- ê¸°ì¡´ í—¤ë” ë¶€ë¶„ì€ ê·¸ëŒ€ë¡œ ìœ ì§€í•©ë‹ˆë‹¤ -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ëª©í‘œ ë‹¬ì„± or Die</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ */
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap');
    
    /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ ì½”ë“œëŠ” ë™ì¼í•˜ê²Œ ìœ ì§€í•©ë‹ˆë‹¤ */
    /* CSS ìƒëµ (ê¸°ì¡´ CSS ìœ ì§€) */
    
    /* ë“œë˜ê·¸ ê°€ëŠ¥í•œ ë°”êµ¬ë‹ˆë¥¼ ìœ„í•œ ì¶”ê°€ ìŠ¤íƒ€ì¼ */
    .draggable-basket {
      cursor: grab;
      touch-action: none; /* í„°ì¹˜ ì´ë²¤íŠ¸ í•¸ë“¤ë§ì„ ìœ„í•´ ë¸Œë¼ìš°ì € ê¸°ë³¸ í„°ì¹˜ ë™ì‘ ë¹„í™œì„±í™” */
      user-select: none; /* í…ìŠ¤íŠ¸ ì„ íƒ ë°©ì§€ */
      -webkit-user-select: none;
      position: absolute;
      bottom: 0;
      z-index: 10;
    }
    
    .draggable-basket:active {
      cursor: grabbing;
    }
    
    /* ê²Œì„ ì˜ì—­ì— ëŒ€í•œ ìŠ¤íƒ€ì¼ ìˆ˜ì • */
    .game-area-container {
      position: relative;
      touch-action: none; /* ì „ì²´ ê²Œì„ ì˜ì—­ë„ ê¸°ë³¸ í„°ì¹˜ ë™ì‘ ë¹„í™œì„±í™” */
      overflow: hidden;
    }
  </style>
</head>
<body>
  <!-- ê¸°ì¡´ HTML êµ¬ì¡° ìœ ì§€ -->
  <!-- ì—¬ê¸°ì„œëŠ” ë³€ê²½ì´ í•„ìš”í•œ ì‚¬ê³¼ ê²Œì„ ë¶€ë¶„ë§Œ ìˆ˜ì •í•©ë‹ˆë‹¤ -->
  
  <!-- ì‚¬ê³¼ ê²Œì„ í™”ë©´ -->
  <div id="appleGameTab" class="tab-content p-4 hidden">
    <div class="text-lg font-bold mb-3 text-center">ì‚¬ê³¼ ê²Œì„</div>
    <div class="bg-red-50 p-4 rounded-lg shadow">
      <div class="text-center text-sm mb-3">
        ì‚¬ê³¼ë¥¼ ë°›ê³  ë²Œë ˆëŠ” í”¼í•˜ì„¸ìš”! ìµœëŒ€ 50ê³¨ë“œ!
      </div>
      
      <div class="relative h-60 bg-blue-50 rounded-lg mb-4 overflow-hidden border-2 border-blue-100 game-area-container">
        <div id="appleGameArea" class="absolute inset-0">
          <!-- ê²Œì„ ìš”ì†Œë“¤ì´ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤ -->
          <div id="gameBasket" class="absolute bottom-0 text-3xl draggable-basket" style="left: 45%;">ğŸ§º</div>
        </div>
        
        <!-- ì¢Œìš° ì´ë™ ë²„íŠ¼ ì œê±°ë¨ -->
        
        <div id="gameTimer" class="absolute top-2 right-2 bg-white bg-opacity-70 text-xs font-bold px-2 py-1 rounded-full">
          30ì´ˆ
        </div>
        
        <div id="gameOverlay" class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
          <div class="bg-white p-4 rounded-lg text-center">
            <div class="text-xl font-bold mb-2">ì¤€ë¹„ ì™„ë£Œ!</div>
            <div class="text-sm mb-3">ì‚¬ê³¼ë¥¼ ë°›ê³  ë²Œë ˆëŠ” í”¼í•˜ì„¸ìš”</div>
            <div class="text-xs mb-3 text-gray-600">ë°”êµ¬ë‹ˆë¥¼ ì¢Œìš°ë¡œ ìŠ¬ë¼ì´ë“œí•˜ì—¬ ì´ë™ì‹œí‚¤ì„¸ìš”!</div>
            <button id="startGameBtn" class="bg-green-500 text-white px-4 py-2 rounded-lg font-bold">
              ê²Œì„ ì‹œì‘!
            </button>
          </div>
        </div>
      </div>
      
      <div class="grid grid-cols-3 gap-2 mb-4">
        <div class="bg-white p-2 rounded-lg shadow text-center">
          <div class="text-xs text-gray-500">ì‚¬ê³¼ ì ìˆ˜</div>
          <div class="font-bold text-base text-red-500"><span id="appleScore">0</span>ê°œ</div>
        </div>
        <div class="bg-white p-2 rounded-lg shadow text-center">
          <div class="text-xs text-gray-500">ë²Œë ˆ ê°ì </div>
          <div class="font-bold text-base text-green-700">-<span id="bugPenalty">0</span>ê°œ</div>
        </div>
        <div class="bg-white p-2 rounded-lg shadow text-center">
          <div class="text-xs text-gray-500">ê³¨ë“œ</div>
          <div class="font-bold text-base text-yellow-500"><span id="appleGold">0</span>ê³¨ë“œ</div>
        </div>
      </div>
      
      <div id="appleGameResult" class="hidden">
        <div class="bg-green-100 text-green-600 text-center p-3 rounded-lg mb-3 text-sm font-bold">
          ê²Œì„ ì¢…ë£Œ! <span id="finalAppleGold">0</span>ê³¨ë“œ íšë“!
        </div>
      </div>
      
      <div class="flex justify-between">
        <button id="appleBackBtn" class="bg-gray-500 text-white font-bold px-4 py-2 rounded-lg">
          ê·¸ë§Œë‘ê¸°
        </button>
        <button id="appleCashOutBtn" class="bg-green-500 text-white font-bold px-4 py-2 rounded-lg hidden">
          í˜„ì¬ ê³¨ë“œ ë°›ê¸°
        </button>
        <button id="applePlayAgainBtn" class="bg-blue-500 text-white font-bold px-4 py-2 rounded-lg hidden">
          ë‹¤ì‹œí•˜ê¸° (ê´‘ê³ )
        </button>
      </div>
    </div>
  </div>
  
  <!-- ë‚˜ë¨¸ì§€ HTML ì½”ë“œ ìœ ì§€ -->
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // ê¸°ì¡´ ì½”ë“œ ìœ ì§€ (íƒ­ ì „í™˜, ì ìˆ˜ ê³„ì‚° ë“±)
      
      // ë³€ê²½í•  ë¶€ë¶„: ì‚¬ê³¼ ê²Œì„ ê´€ë ¨ ì½”ë“œ
      let appleScore = 0;
      let bugPenalty = 0;
      let appleGold = 0;
      let appleGameActive = false;
      let gameInterval;
      let gameTimeLeft = 30;
      let basketPosition = 45; // ë°”êµ¬ë‹ˆ ìœ„ì¹˜ (%)
      const basketWidth = 10; // ë°”êµ¬ë‹ˆ ë„ˆë¹„ (%)
      const basketElement = document.getElementById('gameBasket');
      const gameArea = document.getElementById('appleGameArea');
      const gameAreaContainer = gameArea.parentElement;
      const gameWidth = 100; // ê²Œì„ ì˜ì—­ ë„ˆë¹„ (%)
      
      // ë°”êµ¬ë‹ˆ ë“œë˜ê·¸ ê´€ë ¨ ë³€ìˆ˜
      let isDragging = false;
      let startX = 0;
      let startLeft = 0;
      
      function initAppleGame() {
        // ê²Œì„ ì´ˆê¸°í™” (ê¸°ì¡´ ì½”ë“œ)
        appleScore = 0;
        bugPenalty = 0;
        appleGold = 0;
        appleGameActive = false;
        gameTimeLeft = 30;
        basketPosition = 45;
        basketElement.style.left = `${basketPosition}%`;
        
        // UI ì´ˆê¸°í™” (ê¸°ì¡´ ì½”ë“œ)
        document.getElementById('appleScore').textContent = appleScore;
        document.getElementById('bugPenalty').textContent = bugPenalty;
        document.getElementById('appleGold').textContent = appleGold;
        document.getElementById('gameTimer').textContent = `${gameTimeLeft}ì´ˆ`;
        document.getElementById('appleGameResult').classList.add('hidden');
        
        // ê²Œì„ ìš”ì†Œ ì´ˆê¸°í™” (ê¸°ì¡´ ì½”ë“œ)
        const items = document.querySelectorAll('.falling-item');
        items.forEach(item => item.remove());
        
        // ë²„íŠ¼ ìƒíƒœ ì´ˆê¸°í™” (ê¸°ì¡´ ì½”ë“œ)
        document.getElementById('appleCashOutBtn').classList.add('hidden');
        document.getElementById('applePlayAgainBtn').classList.add('hidden');
        
        // ê²Œì„ ì¤€ë¹„ ì˜¤ë²„ë ˆì´ í‘œì‹œ (ê¸°ì¡´ ì½”ë“œ)
        document.getElementById('gameOverlay').classList.remove('hidden');
      }
      
      // ë“œë˜ê·¸ ì´ë²¤íŠ¸ ì„¤ì • (ìƒˆë¡œìš´ ì½”ë“œ)
      function setupDraggableBasket() {
        // ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸
        basketElement.addEventListener('mousedown', startDrag);
        
        // í„°ì¹˜ ì´ë²¤íŠ¸
        basketElement.addEventListener('touchstart', startDrag, { passive: false });
        
        // ê²Œì„ ì˜ì—­ ì „ì²´ì—ì„œ ë“œë˜ê·¸ ê°€ëŠ¥í•˜ë„ë¡ ì´ë²¤íŠ¸ ì„¤ì •
        gameAreaContainer.addEventListener('mousemove', drag);
        gameAreaContainer.addEventListener('touchmove', drag, { passive: false });
        
        // ë“œë˜ê·¸ ì¢…ë£Œ ì´ë²¤íŠ¸
        document.addEventListener('mouseup', endDrag);
        document.addEventListener('touchend', endDrag);
      }
      
      function startDrag(e) {
        e.preventDefault(); // ê¸°ë³¸ ë™ì‘ ë°©ì§€
        isDragging = true;
        
        // ë§ˆìš°ìŠ¤ ë˜ëŠ” í„°ì¹˜ì˜ ì‹œì‘ ìœ„ì¹˜ ì €ì¥
        if (e.type === 'touchstart') {
          startX = e.touches[0].clientX;
        } else {
          startX = e.clientX;
        }
        
        // í˜„ì¬ ë°”êµ¬ë‹ˆ ìœ„ì¹˜ ì €ì¥
        startLeft = basketPosition;
        
        // ì»¤ì„œ ìŠ¤íƒ€ì¼ ë³€ê²½
        basketElement.style.cursor = 'grabbing';
      }
      
      function drag(e) {
        if (!isDragging) return;
        e.preventDefault(); // ê¸°ë³¸ ë™ì‘ ë°©ì§€
        
        // í˜„ì¬ ë§ˆìš°ìŠ¤/í„°ì¹˜ ìœ„ì¹˜
        let currentX;
        if (e.type === 'touchmove') {
          currentX = e.touches[0].clientX;
        } else {
          currentX = e.clientX;
        }
        
        // ì´ë™ ê±°ë¦¬ ê³„ì‚°
        const deltaX = currentX - startX;
        
        // ê²Œì„ ì˜ì—­ì˜ ë„ˆë¹„ë¥¼ ê¸°ì¤€ìœ¼ë¡œ % ë‹¨ìœ„ ë³€í™˜
        const gameAreaWidth = gameAreaContainer.clientWidth;
        const deltaPercent = (deltaX / gameAreaWidth) * 100;
        
        // ìƒˆë¡œìš´ ìœ„ì¹˜ ê³„ì‚° (ê²½ê³„ ì œí•œ)
        let newPosition = startLeft + deltaPercent;
        newPosition = Math.max(5, Math.min(90, newPosition)); // 5% ~ 90% ë²”ìœ„ë¡œ ì œí•œ
        
        // ë°”êµ¬ë‹ˆ ìœ„ì¹˜ ì—…ë°ì´íŠ¸
        basketPosition = newPosition;
        basketElement.style.left = `${basketPosition}%`;
      }
      
      function endDrag() {
        isDragging = false;
        basketElement.style.cursor = 'grab';
      }
      
      // ê¸°ì¡´ ê²Œì„ ê´€ë ¨ í•¨ìˆ˜ë“¤
      function startGameTimer() {
        const timerInterval = setInterval(() => {
          gameTimeLeft--;
          document.getElementById('gameTimer').textContent = `${gameTimeLeft}ì´ˆ`;
          
          // ì‹œê°„ì´ ë‹¤ ë˜ë©´ ê²Œì„ ì¢…ë£Œ
          if (gameTimeLeft <= 0) {
            clearInterval(timerInterval);
            clearInterval(gameInterval);
            endGame();
          }
        }, 1000);
      }
      
      function endGame() {
        appleGameActive = false;
        
        // ê³¨ë“œ ê³„ì‚° (ì‚¬ê³¼ 1ê°œë‹¹ 3ê³¨ë“œ, ë²Œë ˆ 1ê°œë‹¹ -2ê³¨ë“œ)
        const totalScore = Math.max(0, appleScore - bugPenalty);
        appleGold = totalScore * 3;
        
        // ìƒê¸ˆ í•œë„ ì„¤ì •
        appleGold = Math.min(appleGold, 50);
        
        // UI ì—…ë°ì´íŠ¸
        document.getElementById('appleGold').textContent = appleGold;
        document.getElementById('appleGameResult').classList.remove('hidden');
        document.getElementById('finalAppleGold').textContent = appleGold;
        
        // ê³¨ë“œ ì¦ê°€
        const gold = document.getElementById('gold');
        gold.textContent = parseInt(gold.textContent) + appleGold;
        
        // ì•Œë¦¼ í‘œì‹œ
        showToast(`${appleGold} ê³¨ë“œê°€ ì§€ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');
        
        // ë‹¤ì‹œí•˜ê¸° ë²„íŠ¼ í‘œì‹œ
        document.getElementById('applePlayAgainBtn').classList.remove('hidden');
      }
      
      function generateFallingItem() {
        if (!appleGameActive) return;
        
        const gameArea = document.getElementById('appleGameArea');
        const item = document.createElement('div');
        
        // 80% í™•ë¥ ë¡œ ì‚¬ê³¼, 20% í™•ë¥ ë¡œ ë²Œë ˆ
        const isApple = Math.random() < 0.8;
        item.textContent = isApple ? 'ğŸ' : 'ğŸ›';
        item.className = 'falling-item text-2xl';
        item.dataset.type = isApple ? 'apple' : 'bug';
        
        // ëœë¤ ìœ„ì¹˜ (ì¢Œìš°)
        const left = Math.floor(Math.random() * 85) + 5; // 5% ~ 90%
        item.style.left = `${left}%`;
        
        // ëœë¤ ì†ë„ (ì•„ë˜ë¡œ ë–¨ì–´ì§€ëŠ” ì‹œê°„)
        const fallSpeed = Math.random() * 1 + 1.5; // 1.5ì´ˆ ~ 2.5ì´ˆ
        item.style.animationDuration = `${fallSpeed}s`;
        
        gameArea.appendChild(item);
        
        // ì•„ì´í…œì´ ë°”ë‹¥ì— ë‹¿ì•˜ì„ ë•Œ ê²€ì‚¬
        item.addEventListener('animationend', () => {
          // ë°”êµ¬ë‹ˆ ìœ„ì¹˜ì™€ ì•„ì´í…œ ìœ„ì¹˜ ë¹„êµ
          const itemLeft = parseFloat(item.style.left);
          
          // ì¶©ëŒ ê°ì§€ (ë°”êµ¬ë‹ˆì™€ ì•„ì´í…œì´ ê²¹ì¹˜ëŠ”ì§€)
          if (itemLeft >= basketPosition - basketWidth/2 && itemLeft <= basketPosition + basketWidth/2) {
            // ë°”êµ¬ë‹ˆì— ë“¤ì–´ì˜´
            if (item.dataset.type === 'apple') {
              // ì‚¬ê³¼ íšë“
              appleScore++;
              document.getElementById('appleScore').textContent = appleScore;
              
              // ì ìˆ˜ ì¦ê°€ ì• ë‹ˆë©”ì´ì…˜
              const scoreElement = document.getElementById('appleScore');
              scoreElement.classList.add('score-pop');
              setTimeout(() => {
                scoreElement.classList.remove('score-pop');
              }, 500);
            } else {
              // ë²Œë ˆ ê°ì 
              bugPenalty++;
              document.getElementById('bugPenalty').textContent = bugPenalty;
              
              // ê°ì  ì• ë‹ˆë©”ì´ì…˜
              const penaltyElement = document.getElementById('bugPenalty');
              penaltyElement.classList.add('penalty-shake');
              setTimeout(() => {
                penaltyElement.classList.remove('penalty-shake');
              }, 300);
              
              // ë°”êµ¬ë‹ˆ í”ë“¤ë¦¼ ì• ë‹ˆë©”ì´ì…˜
              basketElement.classList.add('shake');
              setTimeout(() => {
                basketElement.classList.remove('shake');
              }, 300);
            }
          }
          
          // ì•„ì´í…œ ì œê±°
          item.remove();
        });
      }
      
      // ê²Œì„ ì‹œì‘ ë²„íŠ¼
      document.getElementById('startGameBtn').addEventListener('click', function() {
        // ê²Œì„ ì¤€ë¹„ ì˜¤ë²„ë ˆì´ ìˆ¨ê¸°ê¸°
        document.getElementById('gameOverlay').classList.add('hidden');
        
        // ê²Œì„ í™œì„±í™”
        appleGameActive = true;
        
        // íƒ€ì´ë¨¸ ì‹œì‘
        startGameTimer();
        
        // ì•„ì´í…œ ìƒì„± ì‹œì‘
        gameInterval = setInterval(generateFallingItem, 800); // 0.8ì´ˆë§ˆë‹¤ ì•„ì´í…œ ìƒì„±
      });
      
      // ì‚¬ê³¼ ê²Œì„ ë’¤ë¡œê°€ê¸° ë²„íŠ¼
      document.getElementById('appleBackBtn').addEventListener('click', () => {
        // ê²Œì„ ì¤‘ì´ë¼ë©´ ì¢…ë£Œ
        if (appleGameActive) {
          clearInterval(gameInterval);
        }
        
        switchTab('homeTab');
      });
      
      // ì‚¬ê³¼ ê²Œì„ ë‹¤ì‹œí•˜ê¸° ë²„íŠ¼
      document.getElementById('applePlayAgainBtn').addEventListener('click', () => {
        // ê´‘ê³  ì‹œì²­ í›„ ë‹¤ì‹œí•˜ê¸°
        watchAd(() => {
          initAppleGame();
        });
      });
      
      // ì‚¬ê³¼ ê²Œì„ íƒ­ì´ í™œì„±í™”ë  ë•Œ ë“œë˜ê·¸ ì´ë²¤íŠ¸ ì„¤ì •
      document.getElementById('appleGameBtn').addEventListener('click', () => {
        // ê¸°ì¡´ ì½”ë“œ
        tabContents.forEach(content => {
          content.classList.add('hidden');
          content.classList.remove('active');
        });
        
        document.getElementById('appleGameTab').classList.remove('hidden');
        document.getElementById('appleGameTab').classList.add('active');
        
        // ë“œë˜ê·¸ ì´ë²¤íŠ¸ ì„¤ì • (ì¶”ê°€)
        setupDraggableBasket();
        
        // ì‚¬ê³¼ ê²Œì„ ì´ˆê¸°í™”
        initAppleGame();
      });
      
      // ë‚˜ë¨¸ì§€ ê¸°ì¡´ ì½”ë“œ ìœ ì§€
    });
  </script>
</body>
</html>
