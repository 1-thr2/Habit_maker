<!DOCTYPE html>
<html lang="ko">
<head>
  <!-- ê¸°ì¡´ ì½”ë“œ ê·¸ëŒ€ë¡œ ìœ ì§€ -->
  <!-- CSS ë¶€ë¶„ì— ì¶”ê°€ -->
  <style>
    /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ ê·¸ëŒ€ë¡œ ìœ ì§€í•˜ê³  ì•„ë˜ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
    
    /* ë°”êµ¬ë‹ˆ ë“œë˜ê·¸ ê°€ëŠ¥ ìŠ¤íƒ€ì¼ */
    .draggable {
      cursor: grab;
      user-select: none;
      touch-action: none;
    }
    
    .draggable:active {
      cursor: grabbing;
    }
    
    /* ê²Œì„ ì»¨íŠ¸ë¡¤ ë²„íŠ¼ ìˆ¨ê¹€ */
    .controls-hidden {
      display: none;
    }
  </style>
</head>
<body>
  <!-- ê¸°ì¡´ HTML ì½”ë“œëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€í•˜ë˜ ì•„ë˜ ë¶€ë¶„ë§Œ ìˆ˜ì • -->
  
  <!-- ì‚¬ê³¼ ê²Œì„ í™”ë©´ì—ì„œ ì»¨íŠ¸ë¡¤ ë²„íŠ¼ ì œê±° -->
  <div id="appleGameTab" class="tab-content p-4 hidden">
    <div class="text-lg font-bold mb-3 text-center">ì‚¬ê³¼ ê²Œì„</div>
    <div class="bg-red-50 p-4 rounded-lg shadow">
      <div class="text-center text-sm mb-3">
        ì‚¬ê³¼ë¥¼ ë°›ê³  ë²Œë ˆëŠ” í”¼í•˜ì„¸ìš”! ìµœëŒ€ 50ê³¨ë“œ!
      </div>
      
      <div class="relative h-60 bg-blue-50 rounded-lg mb-4 overflow-hidden border-2 border-blue-100">
        <div id="appleGameArea" class="absolute inset-0">
          <!-- ê²Œì„ ìš”ì†Œë“¤ì´ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤ -->
          <div id="gameBasket" class="absolute bottom-0 text-3xl draggable" style="left: 45%;">ğŸ§º</div>
        </div>
        
        <!-- ê²Œì„ ì»¨íŠ¸ë¡¤ ë²„íŠ¼ ì œê±° -->
        <!-- <div id="gameControlsOverlay" class="absolute inset-x-0 bottom-0 h-12 flex justify-between items-center z-10 px-4 controls-hidden">
          <button id="moveLeftBtn" class="bg-blue-500 bg-opacity-70 text-white h-10 w-10 rounded-full flex items-center justify-center text-xl">
            â†
          </button>
          <button id="moveRightBtn" class="bg-blue-500 bg-opacity-70 text-white h-10 w-10 rounded-full flex items-center justify-center text-xl">
            â†’
          </button>
        </div> -->
        
        <div id="gameTimer" class="absolute top-2 right-2 bg-white bg-opacity-70 text-xs font-bold px-2 py-1 rounded-full">
          30ì´ˆ
        </div>
        
        <div id="gameOverlay" class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
          <div class="bg-white p-4 rounded-lg text-center">
            <div class="text-xl font-bold mb-2">ì¤€ë¹„ ì™„ë£Œ!</div>
            <div class="text-sm mb-3">í™”ë©´ì„ ìŠ¬ë¼ì´ë“œí•´ì„œ ë°”êµ¬ë‹ˆë¥¼ ì›€ì§ì´ì„¸ìš”</div>
            <button id="startGameBtn" class="bg-green-500 text-white px-4 py-2 rounded-lg font-bold">
              ê²Œì„ ì‹œì‘!
            </button>
          </div>
        </div>
      </div>
      
      <div class="grid grid-cols-3 gap-2 mb-4">
        <div class="bg-white p-2 rounded-lg shadow text-center">
          <div class="text-xs text-gray-500">ì‚¬ê³¼ ì ìˆ˜</div>
          <div class="font-bold text-base text-red-500"><span id="appleScore">0</span>ê°œ</div>
        </div>
        <div class="bg-white p-2 rounded-lg shadow text-center">
          <div class="text-xs text-gray-500">ë²Œë ˆ ê°ì </div>
          <div class="font-bold text-base text-green-700">-<span id="bugPenalty">0</span>ê°œ</div>
        </div>
        <div class="bg-white p-2 rounded-lg shadow text-center">
          <div class="text-xs text-gray-500">ê³¨ë“œ</div>
          <div class="font-bold text-base text-yellow-500"><span id="appleGold">0</span>ê³¨ë“œ</div>
        </div>
      </div>
      
      <div id="appleGameResult" class="hidden">
        <div class="bg-green-100 text-green-600 text-center p-3 rounded-lg mb-3 text-sm font-bold">
          ê²Œì„ ì¢…ë£Œ! <span id="finalAppleGold">0</span>ê³¨ë“œ íšë“!
        </div>
      </div>
      
      <div class="flex justify-between">
        <button id="appleBackBtn" class="bg-gray-500 text-white font-bold px-4 py-2 rounded-lg">
          ê·¸ë§Œë‘ê¸°
        </button>
        <button id="appleCashOutBtn" class="bg-green-500 text-white font-bold px-4 py-2 rounded-lg hidden">
          í˜„ì¬ ê³¨ë“œ ë°›ê¸°
        </button>
        <button id="applePlayAgainBtn" class="bg-blue-500 text-white font-bold px-4 py-2 rounded-lg hidden">
          ë‹¤ì‹œí•˜ê¸° (ê´‘ê³ )
        </button>
      </div>
    </div>
  </div>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // ê¸°ì¡´ ì½”ë“œ ìœ ì§€
      
      // ì‚¬ê³¼ ê²Œì„ ê´€ë ¨ ì½”ë“œ ìˆ˜ì •
      let appleScore = 0;
      let bugPenalty = 0;
      let appleGold = 0;
      let appleGameActive = false;
      let gameInterval;
      let gameTimeLeft = 30;
      let basketPosition = 45; // ë°”êµ¬ë‹ˆ ìœ„ì¹˜ (%)
      const basketWidth = 10; // ë°”êµ¬ë‹ˆ ë„ˆë¹„ (%)
      const basketElement = document.getElementById('gameBasket');
      const gameArea = document.getElementById('appleGameArea');
      const gameWidth = 100; // ê²Œì„ ì˜ì—­ ë„ˆë¹„ (%)
      
      // ê¸°ì¡´ ì‚¬ê³¼ ê²Œì„ ì´ˆê¸°í™” í•¨ìˆ˜ - ê·¸ëŒ€ë¡œ ìœ ì§€
      function initAppleGame() {
        // ê²Œì„ ì´ˆê¸°í™”
        appleScore = 0;
        bugPenalty = 0;
        appleGold = 0;
        appleGameActive = false;
        gameTimeLeft = 30;
        basketPosition = 45;
        basketElement.style.left = `${basketPosition}%`;
        
        // UI ì´ˆê¸°í™”
        document.getElementById('appleScore').textContent = appleScore;
        document.getElementById('bugPenalty').textContent = bugPenalty;
        document.getElementById('appleGold').textContent = appleGold;
        document.getElementById('gameTimer').textContent = `${gameTimeLeft}ì´ˆ`;
        document.getElementById('appleGameResult').classList.add('hidden');
        
        // ê²Œì„ ìš”ì†Œ ì´ˆê¸°í™”
        const items = document.querySelectorAll('.falling-item');
        items.forEach(item => item.remove());
        
        // ë²„íŠ¼ ìƒíƒœ ì´ˆê¸°í™”
        document.getElementById('appleCashOutBtn').classList.add('hidden');
        document.getElementById('applePlayAgainBtn').classList.add('hidden');
        
        // ê²Œì„ ì¤€ë¹„ ì˜¤ë²„ë ˆì´ í‘œì‹œ
        document.getElementById('gameOverlay').classList.remove('hidden');
      }
      
      // ê²Œì„ ì‹œì‘ ë²„íŠ¼
      document.getElementById('startGameBtn').addEventListener('click', function() {
        // ê²Œì„ ì¤€ë¹„ ì˜¤ë²„ë ˆì´ ìˆ¨ê¸°ê¸°
        document.getElementById('gameOverlay').classList.add('hidden');
        
        // ê²Œì„ í™œì„±í™”
        appleGameActive = true;
        
        // íƒ€ì´ë¨¸ ì‹œì‘
        startGameTimer();
        
        // ì•„ì´í…œ ìƒì„± ì‹œì‘
        gameInterval = setInterval(generateFallingItem, 800); // 0.8ì´ˆë§ˆë‹¤ ì•„ì´í…œ ìƒì„±
      });
      
      // ê¸°ì¡´ í•¨ìˆ˜ë“¤ - ê·¸ëŒ€ë¡œ ìœ ì§€
      function startGameTimer() {
        const timerInterval = setInterval(() => {
          gameTimeLeft--;
          document.getElementById('gameTimer').textContent = `${gameTimeLeft}ì´ˆ`;
          
          // ì‹œê°„ì´ ë‹¤ ë˜ë©´ ê²Œì„ ì¢…ë£Œ
          if (gameTimeLeft <= 0) {
            clearInterval(timerInterval);
            clearInterval(gameInterval);
            endGame();
          }
        }, 1000);
      }
      
      function endGame() {
        appleGameActive = false;
        
        // ê³¨ë“œ ê³„ì‚° (ì‚¬ê³¼ 1ê°œë‹¹ 3ê³¨ë“œ, ë²Œë ˆ 1ê°œë‹¹ -2ê³¨ë“œ)
        const totalScore = Math.max(0, appleScore - bugPenalty);
        appleGold = totalScore * 3;
        
        // ìƒê¸ˆ í•œë„ ì„¤ì •
        appleGold = Math.min(appleGold, 50);
        
        // UI ì—…ë°ì´íŠ¸
        document.getElementById('appleGold').textContent = appleGold;
        document.getElementById('appleGameResult').classList.remove('hidden');
        document.getElementById('finalAppleGold').textContent = appleGold;
        
        // ê³¨ë“œ ì¦ê°€
        const gold = document.getElementById('gold');
        gold.textContent = parseInt(gold.textContent) + appleGold;
        
        // ì•Œë¦¼ í‘œì‹œ
        showToast(`${appleGold} ê³¨ë“œê°€ ì§€ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');
        
        // ë‹¤ì‹œí•˜ê¸° ë²„íŠ¼ í‘œì‹œ
        document.getElementById('applePlayAgainBtn').classList.remove('hidden');
      }
      
      function generateFallingItem() {
        if (!appleGameActive) return;
        
        const gameArea = document.getElementById('appleGameArea');
        const item = document.createElement('div');
        
        // 80% í™•ë¥ ë¡œ ì‚¬ê³¼, 20% í™•ë¥ ë¡œ ë²Œë ˆ
        const isApple = Math.random() < 0.8;
        item.textContent = isApple ? 'ğŸ' : 'ğŸ›';
        item.className = 'falling-item text-2xl';
        item.dataset.type = isApple ? 'apple' : 'bug';
        
        // ëœë¤ ìœ„ì¹˜ (ì¢Œìš°)
        const left = Math.floor(Math.random() * 85) + 5; // 5% ~ 90%
        item.style.left = `${left}%`;
        
        // ëœë¤ ì†ë„ (ì•„ë˜ë¡œ ë–¨ì–´ì§€ëŠ” ì‹œê°„)
        const fallSpeed = Math.random() * 1 + 1.5; // 1.5ì´ˆ ~ 2.5ì´ˆ
        item.style.animationDuration = `${fallSpeed}s`;
        
        gameArea.appendChild(item);
        
        // ì•„ì´í…œì´ ë°”ë‹¥ì— ë‹¿ì•˜ì„ ë•Œ ê²€ì‚¬
        item.addEventListener('animationend', () => {
          // ë°”êµ¬ë‹ˆ ìœ„ì¹˜ì™€ ì•„ì´í…œ ìœ„ì¹˜ ë¹„êµ
          const itemLeft = parseFloat(item.style.left);
          
          // ì¶©ëŒ ê°ì§€ (ë°”êµ¬ë‹ˆì™€ ì•„ì´í…œì´ ê²¹ì¹˜ëŠ”ì§€)
          if (itemLeft >= basketPosition - basketWidth/2 && itemLeft <= basketPosition + basketWidth/2) {
            // ë°”êµ¬ë‹ˆì— ë“¤ì–´ì˜´
            if (item.dataset.type === 'apple') {
              // ì‚¬ê³¼ íšë“
              appleScore++;
              document.getElementById('appleScore').textContent = appleScore;
              
              // ì ìˆ˜ ì¦ê°€ ì• ë‹ˆë©”ì´ì…˜
              const scoreElement = document.getElementById('appleScore');
              scoreElement.classList.add('score-pop');
              setTimeout(() => {
                scoreElement.classList.remove('score-pop');
              }, 500);
            } else {
              // ë²Œë ˆ ê°ì 
              bugPenalty++;
              document.getElementById('bugPenalty').textContent = bugPenalty;
              
              // ê°ì  ì• ë‹ˆë©”ì´ì…˜
              const penaltyElement = document.getElementById('bugPenalty');
              penaltyElement.classList.add('penalty-shake');
              setTimeout(() => {
                penaltyElement.classList.remove('penalty-shake');
              }, 300);
              
              // ë°”êµ¬ë‹ˆ í”ë“¤ë¦¼ ì• ë‹ˆë©”ì´ì…˜
              basketElement.classList.add('shake');
              setTimeout(() => {
                basketElement.classList.remove('shake');
              }, 300);
            }
          }
          
          // ì•„ì´í…œ ì œê±°
          item.remove();
        });
      }
      
      // ì´ë™ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°í•˜ê³  ìƒˆë¡œìš´ ë“œë˜ê·¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
      
      // ë°”êµ¬ë‹ˆ ë“œë˜ê·¸ ê¸°ëŠ¥ êµ¬í˜„
      let isDragging = false;
      let lastTouchX = 0;
      let lastMouseX = 0;
      const gameAreaBounds = gameArea.getBoundingClientRect();
      
      // í„°ì¹˜ ì´ë²¤íŠ¸ (ëª¨ë°”ì¼)
      basketElement.addEventListener('touchstart', function(e) {
        if (!appleGameActive) return;
        isDragging = true;
        lastTouchX = e.touches[0].clientX;
        basketElement.classList.add('grabbing');
        e.preventDefault(); // ê¸°ë³¸ ë™ì‘ ë°©ì§€
      });
      
      document.addEventListener('touchmove', function(e) {
        if (!isDragging || !appleGameActive) return;
        
        const gameAreaBounds = gameArea.getBoundingClientRect();
        const touch = e.touches[0];
        const deltaX = touch.clientX - lastTouchX;
        lastTouchX = touch.clientX;
        
        // ì´ë™ ê±°ë¦¬ë¥¼ ê²Œì„ ì˜ì—­ ë„ˆë¹„ì˜ í¼ì„¼íŠ¸ë¡œ ë³€í™˜
        const deltaPercent = (deltaX / gameAreaBounds.width) * 100;
        
        // ë°”êµ¬ë‹ˆ ìœ„ì¹˜ ì—…ë°ì´íŠ¸
        basketPosition = Math.max(0, Math.min(90, basketPosition + deltaPercent));
        basketElement.style.left = `${basketPosition}%`;
        
        e.preventDefault(); // ê¸°ë³¸ ë™ì‘ ë°©ì§€
      });
      
      document.addEventListener('touchend', function() {
        isDragging = false;
        basketElement.classList.remove('grabbing');
      });
      
      document.addEventListener('touchcancel', function() {
        isDragging = false;
        basketElement.classList.remove('grabbing');
      });
      
      // ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸ (PC)
      basketElement.addEventListener('mousedown', function(e) {
        if (!appleGameActive) return;
        isDragging = true;
        lastMouseX = e.clientX;
        basketElement.classList.add('grabbing');
        e.preventDefault(); // ê¸°ë³¸ ë™ì‘ ë°©ì§€
      });
      
      document.addEventListener('mousemove', function(e) {
        if (!isDragging || !appleGameActive) return;
        
        const gameAreaBounds = gameArea.getBoundingClientRect();
        const deltaX = e.clientX - lastMouseX;
        lastMouseX = e.clientX;
        
        // ì´ë™ ê±°ë¦¬ë¥¼ ê²Œì„ ì˜ì—­ ë„ˆë¹„ì˜ í¼ì„¼íŠ¸ë¡œ ë³€í™˜
        const deltaPercent = (deltaX / gameAreaBounds.width) * 100;
        
        // ë°”êµ¬ë‹ˆ ìœ„ì¹˜ ì—…ë°ì´íŠ¸
        basketPosition = Math.max(0, Math.min(90, basketPosition + deltaPercent));
        basketElement.style.left = `${basketPosition}%`;
      });
      
      document.addEventListener('mouseup', function() {
        isDragging = false;
        basketElement.classList.remove('grabbing');
      });
      
      document.addEventListener('mouseleave', function() {
        isDragging = false;
        basketElement.classList.remove('grabbing');
      });
      
      // ê¸°ì¡´ ì‚¬ê³¼ ê²Œì„ ë’¤ë¡œê°€ê¸°/ë‹¤ì‹œí•˜ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ìœ ì§€
      document.getElementById('appleBackBtn').addEventListener('click', () => {
        // ê²Œì„ ì¤‘ì´ë¼ë©´ ì¢…ë£Œ
        if (appleGameActive) {
          clearInterval(gameInterval);
        }
        
        switchTab('homeTab');
      });
      
      document.getElementById('applePlayAgainBtn').addEventListener('click', () => {
        // ê´‘ê³  ì‹œì²­ í›„ ë‹¤ì‹œí•˜ê¸°
        watchAd(() => {
          initAppleGame();
        });
      });
    });
  </script>
</body>
</html>
